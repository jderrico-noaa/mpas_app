workflow:
  tasks:
    metatask_post:
      var:
        fhr: "{% for h in range(0, forecast.mpas['length'] + 1, 6) %}{{ ' %03d' % h }}{% endfor %}"
      task:
        task_upp_#fhr#:
          command: 'source &MPAS_APP;/load_wflow_modules.sh &PLATFORM; ; python &MPAS_APP;/scripts/upp.py'
          account: "{{ platform.account }}"
          join:
            cyclestr:
              value: '&LOGDIR;/{{ jobname }}_@Y@m@d@H.log'
          walltime: "{{ post.upp.execution.batchargs.walltime }}"
          nodes: "{{ post.upp.execution.batchargs.nodes }}:ppn={{ post.upp.execution.batchargs.tasks_per_node }}"
          partition: "{{ post.upp.execution.batchargs.partition }}"
          envars:
            CONFIG_PATH: '&EXPERIMENT_CONFIG;'
            CYCLE:
              cyclestr:
                value: "@Y-@m-@dT@H:@M:@S"
            LEAD: '#fhr#'
          dependency:
            taskdep:
              attrs:
                task: mpassit_#fhr#
